<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="./static/style.css" />
    <!-- This is our database of messages -->
    <script src="./static/post-store.js"></script>

    <script>
        var defaultMessage = "Welcome to ManyKin! The world awaits your word.<br><br>"
            + " This is your <i>personal blog</i> where you can share "
            + "your innermost thoughts! Don't worry, the ManyKin are always waiting, "
            + "listening, watching. They already know your deepest, darkest secrets."
            + "Come, speak your fears to the ancient ones.";

        var DB = new PostDB(defaultMessage);

        function displayPosts() {
            var containerEl = document.getElementById("post-container");
            containerEl.innerHTML = "";

            var posts = DB.getPosts();
            for (var i = 0; i < posts.length; i++) {
                var html = '<table class="message"> <tr> <td valign=top> '
                    + '<img class="profpic" src="./static/player_icon.png"> </td> <td valign=top '
                    + ' class="message-container"> <div class="shim"></div>';

                html += '<b>You</b>';
                html += '<span class="date">' + new Date(posts[i].date) + '</span>';
                html += "<blockquote>" + posts[i].message + "</blockquote";
                html += "</td></tr></table>"
                containerEl.innerHTML += html;
            }
        }

        window.onload = function () {
            document.getElementById('clear-form').onsubmit = function () {
                DB.clear(function () { displayPosts() });
                return false;
            }

            document.getElementById('post-form').onsubmit = function () {
                var message = document.getElementById('post-content').value;
                DB.save(message, function () { displayPosts() });
                document.getElementById('post-content').value = "";
                return false;
            }

            displayPosts();
        }

    </script>

</head>

<body id="main">
    <div id="header">
        <img src="./static/ManyKin_icon.gif" style="height: 30px;" />
        <div>Ceaseless watchers, ever vigilent. Tireless and undying...</div>
        <form action="?" id="clear-form">
            <input class="clear" type="submit" value="Clear all posts">
        </form>

    </div>

    <div id="post-container"></div>

    <table class="message">
        <tr>
            <td valign="top">
                <img class="profpic" src="./static/player_icon.png">
            </td>
            <td class="message-container">
                <div class="shim"></div>
                <form action="?" id="post-form">
                    <textarea id="post-content" name="content" rows="2" cols="50"
                        style="width: 95%; height: 100%; margin:auto; padding: 15px;"></textarea>
                    <input class="share" type="submit" value="POST">
                    <input type="hidden" name="action" value="sign">
                </form>
            </td>
        </tr>
    </table>

</body>

</html>